<div class="question-bank">
  <!-- Table view -->
  <ng-container *ngIf="!showTest; else creationView">
    <div class="header">
      <!-- <h2>All Tests</h2> -->
      <button (click)="newForm()" class="add-btn">
        Add New Test
        <svg xmlns="http://www.w3.org/2000/svg" width="21" height="20" viewBox="0 0 21 20" fill="none">
          <path d="M10.5003 4.16663V15.8333M4.66699 9.99996H16.3337" stroke="white" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
      <div class="flex1">

        <div class="filter" id="filterButton" (click)="toggleFilterDropdown(); $event.stopPropagation()">

          <i class="pi pi-filter"></i>

          <ul class="menu-list" id="filterDropdown" *ngIf="showFilterDropdown">
            <li class="list" *ngFor="let option of filterOptions"
              (click)="selectFilter(option); $event.stopPropagation()"
              [ngClass]="{ 'active': selectedFilter?.value === option.value }">
              {{ option.label }}
            </li>
          </ul>

        </div>

        <p-iconfield>
          <p-inputicon class="pi pi-search"></p-inputicon>
          <input id="searchBox" type="text" pInputText placeholder="Search" (input)="onSearch($event)" />
        </p-iconfield>

      </div>

    </div>

    <p-table [value]="loading ? [1,2,3,4,5] : filteredTest" [paginator]="!loading" [rows]="10">

      <ng-template pTemplate="header">
        <tr>
          <th>No</th>
          <th>Name</th>
          <th>Duration</th>
          <th>Passing %</th>
          <th>Max Attempts</th>
          <th>Question Bank</th>
          <th style="text-align: center;">Action</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-test let-i="rowIndex">

        <tr *ngIf="!loading; else skeletonRow">
          <td>{{ i + 1 }}</td>
          <td>{{ test.name }}</td>
          <td>{{ test.duration }} min</td>
          <td>{{ test.passingPercent }}%</td>
          <td>{{ test.maxAttempts }}</td>
          <td>{{ test.questionBankName }}</td>
          <td class="button-div">
            <button class="btn-edit" (click)="openTest(test)">Edit</button>
            <button class="btn-edit" (click)="openAssign(test)">Assign</button>
          </td>
        </tr>

        <!-- Skeleton Row -->
        <ng-template #skeletonRow>
          <tr>
            <td><p-skeleton width="2rem"></p-skeleton></td>
            <td><p-skeleton width="100px"></p-skeleton></td>
            <td><p-skeleton width="50px"></p-skeleton></td>
            <td><p-skeleton width="50px"></p-skeleton></td>
            <td><p-skeleton width="50px"></p-skeleton></td>
            <td><p-skeleton width="100px"></p-skeleton></td>
            <td><p-skeleton width="120px"></p-skeleton></td>
          </tr>
        </ng-template>

      </ng-template>

    </p-table>

  </ng-container>

  <!-- Creation / Edit view -->
  <ng-template #creationView>
    <app-test-creation [testData]="editingTest" (closeForm)="onCloseCreation()">
    </app-test-creation>
  </ng-template>
</div>

<!-- Assign overlay stays as-is -->
<div *ngIf="showAssignPopup" class="overlay">
  <div class="">
    <app-test-assignment [test]="assignTest" (closeForm)="showAssignPopup = false">
    </app-test-assignment>
  </div>
</div>