<div *ngIf="!selectedInterview" class="interview-table">
  <div class="header">
    <!-- <h2>Exit Interviews</h2> -->
    <div class="flex1">
      <div class="filter" (click)="toggleFilterDropdoen()">
        <i class="pi pi-filter"></i>
        <ul class="menu-list" *ngIf="showFilterDropdown">
          <li class="list" *ngFor="let option of filterOptions" (click)="selectFilter(option); $event.stopPropagation()"
            [ngClass]="{ 'active': selectedFilter?.value === option.value }">
            {{ option.label }}
          </li>
        </ul>
      </div>

      <p-iconfield>
        <p-inputicon class="pi pi-search" />
        <input type="text" pInputText placeholder="Search" (input)="onSearch($event)" />
      </p-iconfield>
    </div>
  </div>
  <p-table [value]="loading ? [1, 2, 3, 4, 5] : filteredInterviews" [paginator]="!loading" [rows]="10"
    responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th>No</th>
        <th>EMP ID</th>
        <th>Name</th>
        <th>Department</th>
        <th>Date</th>
        <th>Interviewer</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </ng-template>


    <ng-template pTemplate="body" let-interview let-i="rowIndex">

      <ng-container *ngIf="!loading; else skeletonRow">
        <tr>
          <td>{{ i + 1 }}</td>
          <td>{{ interview.employee?.employeeCode }}</td>
          <td>
            <div class="flex align-items-center gap-2">
              <img class="profile-pic" src="/img.png" alt="Employee photo" />
              <div>
                {{ interview.employee?.firstName }} {{ interview.employee?.lastName }}
              </div>
            </div>
          </td>
          <td>
            <span class="dept-badge"
              [ngStyle]="{ backgroundColor: getDepartmentColors(interview.employee?.departmentId).badgeColor }">
              <span class="dot"
                [ngStyle]="{ backgroundColor: getDepartmentColors(interview.employee?.departmentId).dotColor }">
              </span>
              {{ departmentMap[interview.employee?.departmentId] }}
            </span>
          </td>
          <td>{{ interview.scheduledAt | date: 'dd-MM-yyyy' }}</td>
          <td>{{ interview.interviewerName }}</td>
          <td>
            <p-badge [value]="interview.completedAt ? 'COMPLETED' : (interview.status || 'PENDING')" [severity]="
              interview.completedAt ? 'success' :
              interview.status === 'SCHEDULED' ? 'info' :
              interview.status === 'CANCELLED' ? 'danger' :
              'warn'
            ">
            </p-badge>
          </td>
          <td>
            <button pButton label="View / Edit" (click)="openInterview(interview)"></button>
          </td>
        </tr>
      </ng-container>

      <ng-template #skeletonRow>
        <tr>
          <td><p-skeleton width="2rem"></p-skeleton></td>
          <td><p-skeleton width="4rem"></p-skeleton></td>
          <td>
            <div class="flex align-items-center gap-2">
              <p-skeleton shape="circle" size="2.5rem"></p-skeleton>
              <div class="skeleton">
                <p-skeleton width="80px" height="12px"></p-skeleton>
                <p-skeleton width="60px" height="10px"></p-skeleton>
              </div>
            </div>
          </td>
          <td><p-skeleton width="90px"></p-skeleton></td>
          <td><p-skeleton width="70px"></p-skeleton></td>
          <td><p-skeleton width="90px"></p-skeleton></td>
          <td><p-skeleton width="60px"></p-skeleton></td>
          <td><p-skeleton width="80px"></p-skeleton></td>
        </tr>
      </ng-template>
    </ng-template>

    <!-- Empty message (only when not loading) -->
    <ng-template pTemplate="emptymessage" *ngIf="!loading">
      <tr>
        <td colspan="8" class="no-data">No interviews found.</td>
      </tr>
    </ng-template>
  </p-table>

</div>

<div *ngIf="selectedInterview">
  <app-exit-interview [formData]="selectedInterview" (closeForm)="closeForm()"></app-exit-interview>
</div>