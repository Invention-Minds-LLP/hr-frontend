<div class="summary-container" *ngIf="summary">

    <!-- Candidate + Job header -->
    <p-card class="mb-3">
      <div class="header-row">
        <div>
          <h2>{{ summary.candidate.name }}</h2>
          <p class="muted">{{ summary.candidate.email }}</p>
        </div>
        <p-tag severity="info" [value]="summary.job?.title"></p-tag>
      </div>
    </p-card>
  
    <!-- Timeline of rounds -->
    <p-timeline [value]="summary.interviews" align="alternate" styleClass="customized-timeline">
      <ng-template pTemplate="content" let-i>
        <p-card>
          <div class="round-header">
            <h3>{{ i.stage }}</h3>
            <p-tag [value]="i.result || 'Pending'" [severity]="i.result==='Pass' ? 'success' : i.result==='Fail' ? 'danger' : 'warning'"></p-tag>
          </div>
          <p class="muted">{{ i.startTime | date:'MMM d, y, h:mm a' }}</p>
  
          <!-- Feedback list -->
          <div *ngIf="i.InterviewFeedback?.length">
            <h4>Feedback</h4>
            <div *ngFor="let f of i.InterviewFeedback" class="feedback-card">
              <div class="feedback-header">
                <p-chip [label]="f.name"></p-chip>
                <span class="muted">{{ f.designation }}</span>
                <p-tag severity="success" [value]="'Avg: ' + (f.average ?? '—')"></p-tag>
              </div>
              <p>{{ f.notes || 'No notes' }}</p>
            </div>
          </div>
  
          <!-- HR Review -->
          <div *ngIf="i.InterviewHRReview">
            <h4>HR Review</h4>
            <p><b>Decision:</b> {{ i.InterviewHRReview.conclusion }}</p>
            <p class="muted">{{ i.InterviewHRReview.remarks }}</p>
          </div>
        </p-card>
      </ng-template>
    </p-timeline>
  
    <!-- Test Results -->
    <p-card *ngIf="summary.CandidateAssignedTest?.length" class="mt-3">
      <h3>Evaluation Test</h3>
      <p><b>{{ summary.CandidateAssignedTest[0].test?.name }}</b></p>
      <p>Score: <b>{{ summary.CandidateAssignedTest[0].score ?? '—' }}%</b></p>
      <p>Decision: 
        <p-tag [value]="summary.CandidateAssignedTest[0].reviewDecision || 'Pending'"
               [severity]="summary.CandidateAssignedTest[0].reviewDecision==='PASS' ? 'success' : summary.CandidateAssignedTest[0].reviewDecision==='FAIL' ? 'danger' : 'warning'">
        </p-tag>
      </p>
      <p class="muted">{{ summary.CandidateAssignedTest[0].reviewNote }}</p>
    </p-card>
  
    <!-- Offer -->
    <p-card *ngIf="summary.offer" class="mt-3">
      <h3>Offer Status</h3>
      <p-tag [value]="summary.offer.status" 
             [severity]="summary.offer.status==='SIGNED' ? 'success' : summary.offer.status==='DECLINED' ? 'danger' : 'info'">
      </p-tag>
    </p-card>
  
  </div>
  